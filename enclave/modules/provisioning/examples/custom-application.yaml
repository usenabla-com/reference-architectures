# -----------------------------------------------------------------------------
# Example: Simple Web Application
# -----------------------------------------------------------------------------
apiVersion: usenabla.com/v1alpha1
kind: Application
metadata:
  name: internal-dashboard
  namespace: workloads
spec:
  name: internal-dashboard
  image: ghcr.io/usenabla/dashboard:v1.2.0
  replicas: 2
  port: 3000

  resources:
    cpu: "250m"
    memory: "256Mi"

  environment:
    - name: NODE_ENV
      value: "production"
    - name: LOG_LEVEL
      value: "info"

  secrets:
    - name: DATABASE_URL
      secretName: dashboard-secrets
      key: database-url

  storage:
    enabled: true
    size: 5Gi
    mountPath: /app/data

  ingress:
    enabled: true
    subdomain: dashboard
    requireAuth: true
    allowedRoles:
      - enclave-admin
      - enclave-user

  healthCheck:
    path: /api/health
    initialDelaySeconds: 15
    periodSeconds: 30

---
# -----------------------------------------------------------------------------
# Example: CUI-Classified Application
# Deployed to isolated CUI namespace with enhanced security
# -----------------------------------------------------------------------------
apiVersion: usenabla.com/v1alpha1
kind: Application
metadata:
  name: classified-processor
  namespace: workloads-cui
spec:
  name: classified-processor
  image: ghcr.io/usenabla/cui-processor:v2.0.0
  replicas: 1
  port: 8443
  cuiWorkload: true  # Enables CUI-specific isolation

  resources:
    cpu: "1"
    memory: "1Gi"

  secrets:
    - name: ENCRYPTION_KEY
      secretName: cui-encryption
      key: key
    - name: CUI_DATABASE_URL
      secretName: cui-postgres
      key: connection-string

  ingress:
    enabled: true
    subdomain: classified
    requireAuth: true
    allowedRoles:
      - cui-cleared  # Only CUI-cleared personnel

  healthCheck:
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 60

---
# -----------------------------------------------------------------------------
# Example: Background Worker (no ingress)
# -----------------------------------------------------------------------------
apiVersion: usenabla.com/v1alpha1
kind: Application
metadata:
  name: data-sync-worker
  namespace: workloads
spec:
  name: data-sync-worker
  image: ghcr.io/usenabla/sync-worker:v1.0.5
  replicas: 1
  port: 9090  # Metrics port only

  resources:
    cpu: "500m"
    memory: "512Mi"

  environment:
    - name: WORKER_MODE
      value: "background"
    - name: SYNC_INTERVAL
      value: "300"

  secrets:
    - name: S3_ACCESS_KEY
      secretName: minio-credentials
      key: access-key
    - name: S3_SECRET_KEY
      secretName: minio-credentials
      key: secret-key

  # No ingress - internal worker only

  healthCheck:
    path: /metrics
    initialDelaySeconds: 10
    periodSeconds: 15
